<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&family=Rubik:ital,wght@0,300..900;1,300..900&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link href="style.css" rel="stylesheet">
    <title>Discord Profile</title>
</head>
<body>
    <div class="discord">
        <img src="./img/default-avatar.jpeg" id="profile-picture" width="100px" class="profile-picture" alt="Profile Picture">
        <div>
            <h2 id="username">Username</h2>
            <p id="tagline">#Tagline</p>
            <div class="badges-container" id="badges-container"></div>
        </div>
    </div>

    <div class="discord" style="text-align: center; align-items: center; margin-left: 10px; width: 308px; .slide-in-blurred-right
        -webkit-animation: slide-in-blurred-right 0.6s cubic-bezier(0.230, 1.000, 0.320, 1.000) both;
                animation: slide-in-blurred-right 0.6s cubic-bezier(0.230, 1.000, 0.320, 1.000) both;
    ">
        <h2 style="text-align: center;">Socials</h2>
        <a href="https://www.instagram.com/defo_not_angel_/profilecard/?igsh=MW52d2V0b2dmOWtrcw=="><img src="./img/instagram-brands-solid.png" width="32" style="border-radius: 0; width: 32px; height: 32px;"></a>
        <a href="https://youtube.com/@n0t4ng3i?si=JNgbYk5v3YCwKxzk"><img src="./img/youtube-brands-solid.png" width="32" style="border-radius: 0; width: 32px; height: 23px;"></a>
        <a href="https://steamcommunity.com/id/DefinitelyNotAngel/"><img src="./img/steam-brands-solid.png" width="32" style="border-radius: 0; width: 32px; height: 32px;"></a>
        <a href="https://twitch.com/n0t4ng3l"><img src="./img/twitch-brands-solid.png" width="32" style="border-radius: 0; width: 32px; height: 32px;"></a>
    </div>


    
    
    
    
      <script src="script.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script>
        // API endpoint and token
        const apiEndpoint = "https://discord.com/api/v10/users/@me";
        const authToken = "OTQ2NDMxOTE2NTUzNDEyNjc4.GH4RcC.xsu3XSJ7rfN-jz0qCg0x_FQBr45Sb8YFpf23tY"; // Replace with your actual token

        // Map Discord flags to badge data
        const badgesMap = {
            [1 << 0]: { name: "Discord Employee", icon: "./img/discord-employee.png" },
            [1 << 1]: { name: "Partnered Server Owner", icon: "./img/partnered-owner.png" },
            [1 << 2]: { name: "HypeSquad Events Member", icon: "./img/hypesquad-events.png" },
            [1 << 3]: { name: "Bug Hunter Level 1", icon: "./img/bug-hunter-1.png" },
            [1 << 6]: { name: "House Bravery Member", icon: "./img/hypesquadbravery.svg" },
            [1 << 7]: { name: "House Brilliance Member", icon: "./img/hypesquadbravery.svg" },
            [1 << 8]: { name: "House Balance Member", icon: "./img/house-balance.png" },
            [1 << 9]: { name: "Early Nitro Supporter", icon: "./img/early-supporter.png" },
            [1 << 14]: { name: "Bug Hunter Level 2", icon: "./img/bug-hunter-2.png" },
            [1 << 16]: { name: "Verified Bot", icon: "./img/verified-bot.png" },
            [1 << 17]: { name: "Early Verified Bot Developer", icon: "./img/early-bot-dev.png" },
            [1 << 18]: { name: "Certified Moderator", icon: "./img/certified-mod.png" },
            [1 << 22]: { name: "Active Developer", icon: "./img/active-developer.png" },
        };

        // Function to display badges based on public_flags
        function displayBadges(publicFlags) {
            const badgesContainer = document.getElementById("badges-container");
            badgesContainer.innerHTML = ""; // Clear existing badges

            for (const [flag, badge] of Object.entries(badgesMap)) {
                if (publicFlags & flag) { // Check if the flag is set using bitwise AND
                    const badgeElement = document.createElement("img");
                    badgeElement.classList.add("badge-icon");
                    badgeElement.src = badge.icon;
                    badgeElement.alt = badge.name;
                    badgeElement.title = badge.name; // Tooltip
                    badgesContainer.appendChild(badgeElement);
                }
            }
        }

        // Function to display Spotify activity
        function displaySpotifyActivity(activities) {
            const spotifyContainer = document.getElementById("spotify-info");
            const songNameElement = document.getElementById("song-name");
            const artistNameElement = document.getElementById("artist-name");
            const albumCoverElement = document.getElementById("album-cover");

            const spotifyActivity = activities.find(activity => activity.type === 2 && activity.name === "Spotify");

            if (spotifyActivity) {
                const songName = spotifyActivity.details || "Unknown Song";
                const artistName = spotifyActivity.state || "Unknown Artist";
                const albumCover = spotifyActivity.assets?.large_image
                    ? `https://i.scdn.co/image/${spotifyActivity.assets.large_image.replace("spotify:", "")}`
                    : "./img/default-album.png";

                songNameElement.textContent = songName;
                artistNameElement.textContent = `by ${artistName}`;
                albumCoverElement.src = albumCover;
                albumCoverElement.style.display = "block";
                spotifyContainer.style.display = "block";
            } else {
                songNameElement.textContent = "No song detected";
                artistNameElement.textContent = "";
                albumCoverElement.style.display = "none";
                spotifyContainer.style.display = "none";
            }
        }

        // Function to fetch and update Discord profile
        async function updateDiscordProfile() {
            try {
                const response = await fetch(apiEndpoint, {
                    method: "GET",
                    headers: {
                        "Authorization": `${authToken}`,
                        "Content-Type": "application/json"
                    }
                });

                if (!response.ok) throw new Error("Failed to fetch Discord profile data");

                const data = await response.json();

                // Update the DOM elements
                document.getElementById("username").textContent = data.global_name || "Unknown";
                document.getElementById("tagline").textContent = data.username || "Unknown";
               
                document.getElementById("profile-picture").src = data.avatar
                    ? `https://cdn.discordapp.com/avatars/${data.id}/${data.avatar}.png`
                    : "./img/default-avatar.jpeg";

                // Display user badges
                displayBadges(data.public_flags);

                // Display Spotify activity
                displaySpotifyActivity(data.activities || []);
            } catch (error) {
                console.error("Error updating profile:", error);
            }
        }

        // Fetch and update on page load
        document.addEventListener("DOMContentLoaded", updateDiscordProfile);
        
    </script>



    
</body>
</html>
